# üìã –†–µ—à–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π Supabase (–ë–ï–ó edge functions)

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–∞—Ä–æ–ª—å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.

## –ü—Ä–∏—á–∏–Ω–∞
–ë—ã–ª–æ –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å edge-—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π Supabase.

## –†–µ—à–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π API endpoint –Ω–∞ Node.js –≤–º–µ—Å—Ç–æ edge-—Ñ—É–Ω–∫—Ü–∏–∏.

---

## üìÇ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1Ô∏è‚É£ –ù–æ–≤—ã–π —Ñ–∞–π–ª: server/routes/updatePassword.js
**–ß—Ç–æ —ç—Ç–æ:**
- Express —Ä–æ—É—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ Supabase Admin API
- –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å

**–ì–¥–µ –ø–æ–ª–æ–∂–∏—Ç—å:**
```
/var/www/your-app/routes/updatePassword.js
```

### 2Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥: app/users/[id]/edit.jsx  
**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –í–º–µ—Å—Ç–æ edge-—Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç API `/api/update-password`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üöÄ –¢–†–ò –®–ê–ì–ê –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

### –®–∞–≥ 1: –ü–æ—è–≤–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ VPS
–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `server/routes/updatePassword.js` –Ω–∞ VPS –≤ –ø–∞–ø–∫—É —Ä–æ—É—Ç–æ–≤.

**–ß–µ—Ä–µ–∑ SCP:**
```bash
scp server/routes/updatePassword.js user@5.35.91.118:/path/to/app/routes/
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é** —á–µ—Ä–µ–∑ SCP/SFTP –∫–ª–∏–µ–Ω—Ç.

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–í –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (app.js, server.js, index.js), –Ω–∞–π–¥–∏—Ç–µ –≥–¥–µ –¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç—ã:

```javascript
// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
const updatePasswordRoute = require('./routes/updatePassword');
app.use('/api', updatePasswordRoute);
```

–ï—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ - –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ router.post() –∏–∑ —Ñ–∞–π–ª–∞.

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ù–∞ VPS:
pm2 restart your-app-name
# –∏–ª–∏
systemctl restart your-app
# –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–≥–∞—Å–∏—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å pm2 –ø—Ä–æ—Ü–µ—Å—Å
```

---

## üß™ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–±—ã—Å—Ç—Ä–æ)
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
3. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å
4. –û—Ç–∫—Ä–æ–π—Ç–µ F12 ‚Üí Console
5. –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ `[proceedSave] Response status: 200`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl
```bash
curl -X POST http://5.35.91.118:3000/api/update-password \
  -H "Content-Type: application/json" \
  -d '{"user_id":"test-uuid","password":"Test123456"}'
```

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç: `{"ok":true,"message":"Password updated successfully"}` - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üìä –ß–¢–û –í–ò–î–ù–û –ü–†–ò –†–ê–ë–û–¢–ï

### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (–±—Ä–∞—É–∑–µ—Ä –∫–æ–Ω—Å–æ–ª—å F12):
```
[proceedSave] Attempting to update auth credentials
[proceedSave] Calling update-password API at: http://5.35.91.118:3000
[proceedSave] Response status: 200
[proceedSave] Password/email update successful
```

### –ù–∞ VPS (–ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):
```
[UPDATE_PASSWORD] Updating password for user: <uuid>
[UPDATE_PASSWORD] Password updated successfully for user: <uuid>
```

---

## ‚ùå –ï–°–õ–ò –ù–ï –†–ê–ë–û–¢–ê–ï–¢

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| **404 Not Found** | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ `app.use('/api', updatePasswordRoute)` |
| **Supabase –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞** | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ VPS: `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` |
| **CORS –æ—à–∏–±–∫–∞** | –î–æ–±–∞–≤—å—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `const cors = require('cors'); app.use(cors());` |
| **–ù–µ –≤–∏–¥–Ω—ã –ª–æ–≥–∏ –Ω–∞ VPS** | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç –ª–æ–≥–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (pm2 logs, tail -f) |

---

## üìù –í–ê–ñ–ù–û

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ VPS –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
```
SUPABASE_URL=https://your-supabase-url
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_ANON_KEY=your-anon-key (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

### –ò–º–ø–æ—Ä—Ç Supabase –≤ updatePassword.js

–ï—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∏–º–ø–æ—Ä—Ç–∞, –∏–∑–º–µ–Ω–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É:

```javascript
// –ë—ã–ª–æ:
const { supabaseAdmin } = require('../lib/supabase');

// –ú–æ–∂–µ—Ç –±—ã—Ç—å (–ø—Ä–∏–º–µ—Ä):
const { createClient } = require('@supabase/supabase-js');
const supabaseAdmin = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);
```

---

## üí° –ë–û–ù–£–°: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –í –ë–î

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω –ø–∞—Ä–æ–ª–µ–π - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ –≤ updatePassword.js (—Ç–∞–º —É–∫–∞–∑–∞–Ω–æ –≥–¥–µ).

–¢–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ `SETUP_PASSWORD_LOGS.sql` –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π Supabase.

---

## ‚úÖ –ò–¢–û–ì–û

- **–§–∞–π–ª –Ω–∞ VPS:** 1 (updatePassword.js)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:** 1 (app/users/[id]/edit.jsx)
- **–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** 5-10 –º–∏–Ω—É—Ç
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å)

–ì–æ—Ç–æ–≤–æ! üéâ

---

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 00_LOCAL_SUPABASE_PASSWORD_FIX.md
