# üî¥ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "Invalid Credentials" –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Supabase

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É `errors_invalid_credentials` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞.

## –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏)

### 1. ‚ùå JWT_SECRET –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
–ï—Å–ª–∏ `JWT_SECRET` –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ, –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏ —Å—Ç–∞–Ω—É—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ –°–¢–ê–†–û–ú —Å–µ—Ä–≤–µ—Ä–µ Supabase:
supabase secrets list

# –ù–∞–π–¥–∏—Ç–µ: JWT_SECRET –∏–ª–∏ PGRST_JWT_SECRET
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ

# –ù–∞ –ù–û–í–û–ú —Å–µ—Ä–≤–µ—Ä–µ:
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ—Ç –∂–µ JWT_SECRET –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```

### 2. ‚ùå auth.users —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞
–¢–∞–±–ª–∏—Ü–∞ `auth.users` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–µ—à–∏ –ø–∞—Ä–æ–ª–µ–π. –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –¥–∞–º–ø, –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ:
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (`pgcrypto`) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ù–∞ –ù–û–í–û–ú —Å–µ—Ä–≤–µ—Ä–µ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
SELECT COUNT(*) FROM auth.users;
SELECT id, email, encrypted_password FROM auth.users LIMIT 5;
```

### 3. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
–ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –ø–æ—Ç–æ–º auth, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ** –ø–æ–ª—É—á–∏—Ç–µ –ø–∏—Å—å–º–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
curl -X POST 'https://supabase.monitorapp.ru/auth/v1/auth/reset-password' \
  -H 'apikey: YOUR_ANON_KEY' \
  -H 'Content-Type: application/json' \
  -d '{"email": "Bahtin106@gmail.com"}'
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard: Auth ‚Üí Users ‚Üí Select user ‚Üí Reset Password

**–ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Auth ‚Üí Users
2. –ù–∞–π–¥–∏—Ç–µ `Bahtin106@gmail.com`
3. –ù–∞–∂–º–∏—Ç–µ "Reset Password"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET

**–ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ**, –µ—Å–ª–∏ —ç—Ç–æ Supabase —Ö–æ—Å—Ç:

```bash
# –ß–µ—Ä–µ–∑ Supabase CLI:
supabase secrets list

# –ò–ª–∏ —á–µ—Ä–µ–∑ Dashboard:
# Settings ‚Üí API ‚Üí JWT Settings ‚Üí Secret (exp)
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ SECRET —Å –°–¢–ê–†–û–ì–û —Å–µ—Ä–≤–µ—Ä–∞ –≤ –ù–û–í–´–ô**

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Edge Function:

```typescript
// supabase/functions/restore_users/index.ts
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

export async function POST(req: Request) {
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  const { email, password } = await req.json();

  // 1. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const { data: existing } = await supabase
    .from('auth.users')
    .select('id')
    .eq('email', email)
    .single();

  if (existing) {
    await supabase.auth.admin.deleteUser(existing.id);
  }

  // 2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º
  const { data, error } = await supabase.auth.admin.createUser({
    email,
    password,
    email_confirm: true, // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å—Ä–∞–∑—É
  });

  if (error) {
    return new Response(JSON.stringify({ error: error.message }), {
      status: 400,
      headers: { 'Content-Type': 'application/json' },
    });
  }

  return new Response(JSON.stringify({ data }), {
    status: 200,
    headers: { 'Content-Type': 'application/json' },
  });
}
```

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –æ—à–∏–±–∫—É —Å–µ—Ä–≤–µ—Ä–∞

–Ø —É–∂–µ –¥–æ–±–∞–≤–∏–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç:

```
[DEBUG] Auth attempt during login: {
  errorKey: "errors_invalid_credentials",
  email: "Bahtin106@gmail.com",
  errorStatus: 401,
  errorMessage: "Invalid login credentials",
  fullError: {...}
}
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–æ–±—â–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
curl -I https://supabase.monitorapp.ru/auth/v1/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 200 OK
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

- [ ] 1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `https://supabase.monitorapp.ru` –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET –Ω–∞ —Å—Ç–∞—Ä–æ–º –∏ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- [ ] 3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —á—Ç–æ auth.users —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å (SQL –∑–∞–ø—Ä–æ—Å –≤—ã—à–µ)
- [ ] 4. –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è Bahtin106@gmail.com —á–µ—Ä–µ–∑ Dashboard
- [ ] 5. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º
- [ ] 6. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç—å Edge Function –¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

–î–∞–π—Ç–µ –º–Ω–µ:
1. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `SELECT COUNT(*) FROM auth.users;` (—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ)
2. **JWT_SECRET —Å–æ —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** (–ø–µ—Ä–≤—ã–µ 20 —Å–∏–º–≤–æ–ª–æ–≤, –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–∫—Ä–æ–π—Ç–µ)
3. **–ö–∞–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª–∏ –ë–î**: pg_dump, —Ä—É—á–Ω–æ–π —ç–∫—Å–ø–æ—Ä—Ç, —á—Ç–æ-—Ç–æ –µ—â—ë?
4. **–ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ**: —ç—Ç–æ —á–∏—Å—Ç—ã–π PostgreSQL –∏–ª–∏ Supabase?
