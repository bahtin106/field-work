> **Status (2026-02-11): Legacy reference.** This document contains historical notes about removed hooks (`useQueryWithCache`, `useRealtimeSync`).
> Current data layer uses TanStack Query feature hooks in `src/features/*` with shared keys in `src/shared/query/queryKeys.ts`.
# вњ… РџРѕР»РЅРѕРµ РёСЃРїСЂР°РІР»РµРЅРёРµ РїСЂРѕР±Р»РµРјС‹ Р±РµСЃРєРѕРЅРµС‡РЅРѕРіРѕ СЃРїРёРЅРЅРµСЂР°

## РџСЂРѕР±Р»РµРјР°

РџСЂРё РїРµСЂРµР·Р°РїСѓСЃРєРµ РїСЂРёР»РѕР¶РµРЅРёСЏ С‡РµСЂРµР· Expo Go (РїРѕСЃР»Рµ Р·Р°РєСЂС‹С‚РёСЏ Рё РїРѕРІС‚РѕСЂРЅРѕРіРѕ РѕС‚РєСЂС‹С‚РёСЏ) РїРµСЂРёРѕРґРёС‡РµСЃРєРё РІРѕР·РЅРёРєР°РµС‚ Р±РµСЃРєРѕРЅРµС‡РЅС‹Р№ СЃРїРёРЅРЅРµСЂ Р·Р°РіСЂСѓР·РєРё. РџСЂРёР»РѕР¶РµРЅРёРµ РЅРµ Р·Р°РіСЂСѓР¶Р°РµС‚СЃСЏ, РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ С‚РѕР»СЊРєРѕ РєСЂСѓС‚СЏС‰РёР№СЃСЏ РёРЅРґРёРєР°С‚РѕСЂ.

## РљРѕСЂРЅРµРІС‹Рµ РїСЂРёС‡РёРЅС‹

РџСЂРѕР±Р»РµРјР° РІРѕР·РЅРёРєР°Р»Р° РёР·-Р·Р° **РѕС‚СЃСѓС‚СЃС‚РІРёСЏ РіР°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅС‹С… С‚Р°Р№РјР°СѓС‚РѕРІ** РЅР° РєСЂРёС‚РёС‡РµСЃРєРёС… РїСѓС‚СЏС… Р·Р°РіСЂСѓР·РєРё РґР°РЅРЅС‹С…:

### 1. **useQueryWithCache Р±РµР· С‚Р°Р№РјР°СѓС‚Р°**

- `isLoading` РјРѕРі Р·Р°СЃС‚СЂСЏС‚СЊ РІ `true`, РµСЃР»Рё Р·Р°РїСЂРѕСЃ Рє Supabase Р·Р°РІРёСЃР°Р»
- РќРµ Р±С‹Р»Рѕ Р·Р°С‰РёС‚С‹ РѕС‚ Р·Р°РІРёСЃС€РёС… Promise РІ `queryFn`
- РџСЂРё `enabled=false` СЃРѕСЃС‚РѕСЏРЅРёРµ `isLoading` РЅРµ СЃР±СЂР°СЃС‹РІР°Р»РѕСЃСЊ

### 2. **useAuth Р±РµР· Р·Р°С‰РёС‚С‹**

- `supabase.auth.getSession()` РјРѕРі Р·Р°РІРёСЃРЅСѓС‚СЊ Р±РµР· С‚Р°Р№РјР°СѓС‚Р°
- `isLoading` РѕСЃС‚Р°РІР°Р»СЃСЏ `true` РЅР°РІСЃРµРіРґР°
- Р‘Р»РѕРєРёСЂРѕРІР°Р» useUsers Рё useDepartments С‡РµСЂРµР· С†РµРїРѕС‡РєСѓ Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№

### 3. **Р›РѕРіРёРєР° Р·Р°РіСЂСѓР·РєРё РІ app/users/index.jsx**

- `isLoading = usersLoading && departmentsLoading` Р±Р»РѕРєРёСЂРѕРІР°Р»Р°СЃСЊ РµСЃР»Рё **РѕР±Р°** С…СѓРєР° Р·Р°РІРёСЃР°Р»Рё
- РЈСЃР»РѕРІРёРµ `if (isLoading && users.length === 0)` РїРѕРєР°Р·С‹РІР°Р»Рѕ СЃРїРёРЅРЅРµСЂ Р±РµСЃРєРѕРЅРµС‡РЅРѕ
- РќРµ СѓС‡РёС‚С‹РІР°Р»Рѕ РЅР°Р»РёС‡РёРµ РєСЌС€РёСЂРѕРІР°РЅРЅС‹С… РґР°РЅРЅС‹С…

### 4. **useUsers Рё useDepartments**

- РџР°СЂР°РјРµС‚СЂ `enabled` РЅРµ СѓС‡РёС‚С‹РІР°Р» `isAuthenticated` РєРѕСЂСЂРµРєС‚РЅРѕ
- РџСЂРё С…РѕР»РѕРґРЅРѕРј СЃС‚Р°СЂС‚Рµ `enabled=false` в†’ `isLoading` РЅРµ СЃР±СЂР°СЃС‹РІР°Р»СЃСЏ

### 5. **orders/index.jsx**

- `getUserRole()` РјРѕРі Р·Р°РІРёСЃРЅСѓС‚СЊ Р±РµР· С‚Р°Р№РјР°СѓС‚Р°
- Р‘Р»РѕРєРёСЂРѕРІР°Р» РїРѕРєР°Р· `UniversalHome` Рё РѕСЃС‚Р°Р»СЊРЅРѕР№ UI

## Р РµС€РµРЅРёРµ

### 1. вњ… useQueryWithCache - РіР°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅС‹Рµ С‚Р°Р№РјР°СѓС‚С‹

**Р§С‚Рѕ РёСЃРїСЂР°РІР»РµРЅРѕ:**

- Р”РѕР±Р°РІР»РµРЅ **10-СЃРµРєСѓРЅРґРЅС‹Р№ С‚Р°Р№РјР°СѓС‚** РґР»СЏ РїСЂРёРЅСѓРґРёС‚РµР»СЊРЅРѕРіРѕ СЃР±СЂРѕСЃР° `isLoading`
- Р”РѕР±Р°РІР»РµРЅ **15-СЃРµРєСѓРЅРґРЅС‹Р№ С‚Р°Р№РјР°СѓС‚** РґР»СЏ РІСЃРµС… `queryFn` С‡РµСЂРµР· `Promise.race()`
- Р“Р°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅС‹Р№ СЃР±СЂРѕСЃ `isLoading` РїСЂРё `enabled=false`
- РћР±СЂР°Р±РѕС‚РєР° РѕС€РёР±РѕРє СЃ РіР°СЂР°РЅС‚РёРµР№ СЃР±СЂРѕСЃР° СЃРѕСЃС‚РѕСЏРЅРёСЏ

```javascript
// РўР°Р№РјР°СѓС‚ РґР»СЏ СЂР°Р·Р±Р»РѕРєРёСЂРѕРІРєРё isLoading
useEffect(() => {
  if (!enabled || !isLoading) return;

  const timeout = setTimeout(() => {
    if (mountedRef.current && isLoading) {
      console.warn(`вЏ° useQueryWithCache timeout for ${queryKey} - force stop loading`);
      setIsLoading(false);
      setIsRefreshing(false);
      setIsFetching(false);
    }
  }, 10000); // 10 СЃРµРєСѓРЅРґ РјР°РєСЃРёРјСѓРј

  return () => clearTimeout(timeout);
}, [enabled, isLoading, queryKey]);

// РўР°Р№РјР°СѓС‚ РґР»СЏ queryFn
const timeout = new Promise((_, reject) =>
  setTimeout(() => reject(new Error('Query timeout')), 15000),
);

const result = await Promise.race([queryFn(), timeout]);
```

### 2. вњ… useAuth - Р·Р°С‰РёС‚Р° РѕС‚ Р·Р°РІРёСЃР°РЅРёСЏ

**Р§С‚Рѕ РёСЃРїСЂР°РІР»РµРЅРѕ:**

- **5-СЃРµРєСѓРЅРґРЅС‹Р№ С‚Р°Р№РјР°СѓС‚** РґР»СЏ `getSession()`
- Р“Р°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅС‹Р№ СЃР±СЂРѕСЃ `isLoading` С‡РµСЂРµР· `finally`
- Р—Р°С‰РёС‚Р° РѕС‚ РѕР±РЅРѕРІР»РµРЅРёСЏ unmounted РєРѕРјРїРѕРЅРµРЅС‚Р°

```javascript
const checkAuth = async () => {
  try {
    const timeout = new Promise((resolve) =>
      setTimeout(() => resolve({ data: { session: null } }), 5000),
    );

    const sessionPromise = supabase.auth.getSession();
    const result = await Promise.race([sessionPromise, timeout]);

    const session = result?.data?.session;

    if (mounted) {
      setIsAuthenticated(!!session);
      setUser(session?.user || null);
    }
  } catch {
    if (mounted) {
      setIsAuthenticated(false);
      setUser(null);
    }
  } finally {
    if (mounted) {
      setIsLoading(false); // Р“РђР РђРќРўРР РћР’РђРќРќР«Р™ РЎР‘Р РћРЎ
    }
  }
};
```

### 3. вњ… app/users/index.jsx - СѓР»СѓС‡С€РµРЅРЅР°СЏ Р»РѕРіРёРєР° Р·Р°РіСЂСѓР·РєРё

**Р§С‚Рѕ РёСЃРїСЂР°РІР»РµРЅРѕ:**

- РР·РјРµРЅРµРЅР° Р»РѕРіРёРєР° `isLoading`: РїРѕРєР°Р·С‹РІР°РµРј СЃРїРёРЅРЅРµСЂ С‚РѕР»СЊРєРѕ РµСЃР»Рё **РЅРµС‚ РґР°РЅРЅС‹С… РІРѕРѕР±С‰Рµ**
- РЈС‡РёС‚С‹РІР°СЋС‚СЃСЏ РєСЌС€РёСЂРѕРІР°РЅРЅС‹Рµ РґР°РЅРЅС‹Рµ
- `enabled` Р·Р°РІРёСЃРёС‚ РѕС‚ `!companyIdLoading` РІРјРµСЃС‚Рѕ `!!companyId`

```javascript
// РџРѕРєР°Р·С‹РІР°РµРј loader С‚РѕР»СЊРєРѕ РµСЃР»Рё РћР‘Рђ РёСЃС‚РѕС‡РЅРёРєР° РіСЂСѓР·СЏС‚СЃСЏ Р РЅРµС‚ РґР°РЅРЅС‹С…
const hasAnyData = users.length > 0 || departments.length > 0;
const isLoading = (usersLoading || departmentsLoading) && !hasAnyData;

// enabled СѓС‡РёС‚С‹РІР°РµС‚ Р·Р°РІРµСЂС€РµРЅРёРµ Р·Р°РіСЂСѓР·РєРё companyId
enabled: !companyIdLoading;
```

### 4. вњ… useUsers Рё useDepartments - РєРѕСЂСЂРµРєС‚РЅС‹Р№ enabled

**Р§С‚Рѕ РёСЃРїСЂР°РІР»РµРЅРѕ:**

- `enabled` С‚РµРїРµСЂСЊ РІРєР»СЋС‡Р°РµС‚ РїСЂРѕРІРµСЂРєСѓ `isAuthenticated`
- РќРµ РїС‹С‚Р°РµС‚СЃСЏ Р·Р°РіСЂСѓР¶Р°С‚СЊ РґР°РЅРЅС‹Рµ Р±РµР· Р°РІС‚РѕСЂРёР·Р°С†РёРё

```javascript
// useUsers
enabled: enabled && isAuthenticated;

// useDepartments
enabled: enabled && !!companyId && isAuthenticated;
```

### 5. вњ… orders/index.jsx - Р·Р°С‰РёС‚Р° getUserRole

**Р§С‚Рѕ РёСЃРїСЂР°РІР»РµРЅРѕ:**

- **8-СЃРµРєСѓРЅРґРЅС‹Р№ С‚Р°Р№РјР°СѓС‚** РґР»СЏ `getUserRole()`
- РџСЂРёРЅСѓРґРёС‚РµР»СЊРЅР°СЏ СѓСЃС‚Р°РЅРѕРІРєР° СЂРѕР»Рё `'worker'` РїСЂРё Р·Р°РІРёСЃР°РЅРёРё

```javascript
useEffect(() => {
  if (!isLoading) return;

  const timeout = setTimeout(() => {
    console.warn('вЏ° getUserRole timeout - force stop loading');
    qc.setQueryData(['userRole'], 'worker'); // fallback СЂРѕР»СЊ
  }, 8000);

  return () => clearTimeout(timeout);
}, [isLoading, qc]);
```

## РђСЂС…РёС‚РµРєС‚СѓСЂР° Р·Р°С‰РёС‚С‹

```
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚           app/_layout.js                    в”‚
в”‚  вњ… 10s timeout: initializeApp              в”‚
в”‚  вњ… 12s timeout: force ready                в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
                    в†“
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚         app/orders/index.jsx                в”‚
в”‚  вњ… 8s timeout: getUserRole                 в”‚
в”‚  вњ… 5s MAX_BOOT_MS РґР»СЏ force ready          в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
                    в†“
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚       components/universalhome.jsx          в”‚
в”‚  вњ… РњРіРЅРѕРІРµРЅРЅС‹Р№ СЂРµРЅРґРµСЂ (Р±РµР· Р±Р»РѕРєРёСЂРѕРІРєРё)      в”‚
в”‚  вњ… РџРѕРєР°Р·С‹РІР°РµС‚ UI СЃ placeholders            в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
                    в†“
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚         app/users/index.jsx                 в”‚
в”‚  вњ… РџРѕРєР°Р·С‹РІР°РµС‚ loader С‚РѕР»СЊРєРѕ Р±РµР· РґР°РЅРЅС‹С…     в”‚
в”‚  вњ… РСЃРїРѕР»СЊР·СѓРµС‚ РєСЌС€ РµСЃР»Рё РґРѕСЃС‚СѓРїРµРЅ            в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
                    в†“
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚      hooks/useQueryWithCache.js             в”‚
в”‚  вњ… 10s timeout: isLoading force reset      в”‚
в”‚  вњ… 15s timeout: queryFn timeout            в”‚
в”‚  вњ… РЎР±СЂРѕСЃ РїСЂРё disabled                      в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
                    в†“
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚          hooks/useAuth.js                   в”‚
в”‚  вњ… 5s timeout: getSession                  в”‚
в”‚  вњ… Р“Р°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅС‹Р№ finally                 в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
```

## РЈСЂРѕРІРЅРё Р·Р°С‰РёС‚С‹ (Defense in Depth)

### РЈСЂРѕРІРµРЅСЊ 1: Р“Р»РѕР±Р°Р»СЊРЅС‹Рµ С‚Р°Р№РјР°СѓС‚С‹ (app/\_layout.js)

- **10 СЃРµРєСѓРЅРґ**: `initializeApp` РјР°РєСЃРёРјР°Р»СЊРЅРѕРµ РІСЂРµРјСЏ
- **12 СЃРµРєСѓРЅРґ**: force ready РґР»СЏ UI

### РЈСЂРѕРІРµРЅСЊ 2: Р­РєСЂР°РЅРЅС‹Рµ С‚Р°Р№РјР°СѓС‚С‹

- **8 СЃРµРєСѓРЅРґ**: `getUserRole` РІ orders/index.jsx
- **5 СЃРµРєСѓРЅРґ**: `MAX_BOOT_MS` РґР»СЏ РїСЂРёРЅСѓРґРёС‚РµР»СЊРЅРѕРіРѕ РїРѕРєР°Р·Р° UI

### РЈСЂРѕРІРµРЅСЊ 3: РҐСѓРєРё Р·Р°РіСЂСѓР·РєРё РґР°РЅРЅС‹С…

- **10 СЃРµРєСѓРЅРґ**: `useQueryWithCache` СЃР±СЂРѕСЃ `isLoading`
- **15 СЃРµРєСѓРЅРґ**: С‚Р°Р№РјР°СѓС‚ РґР»СЏ `queryFn`
- **5 СЃРµРєСѓРЅРґ**: `useAuth.getSession()`

### РЈСЂРѕРІРµРЅСЊ 4: РЈРјРЅР°СЏ Р»РѕРіРёРєР° Р·Р°РіСЂСѓР·РєРё

- РџРѕРєР°Р· РєСЌС€РёСЂРѕРІР°РЅРЅС‹С… РґР°РЅРЅС‹С… РЅРµРјРµРґР»РµРЅРЅРѕ (stale-while-revalidate)
- Spinner С‚РѕР»СЊРєРѕ РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РґР°РЅРЅС‹С…
- `enabled` СѓС‡РёС‚С‹РІР°РµС‚ СЃРѕСЃС‚РѕСЏРЅРёРµ Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№

## Р РµР·СѓР»СЊС‚Р°С‚

вњ… **Р“Р°СЂР°РЅС‚РёСЂРѕРІР°РЅРЅР°СЏ СЂР°Р·Р±Р»РѕРєРёСЂРѕРІРєР° UI** С‡РµСЂРµР· РјР°РєСЃРёРјСѓРј 12 СЃРµРєСѓРЅРґ (РіР»РѕР±Р°Р»СЊРЅС‹Р№ С‚Р°Р№РјР°СѓС‚)  
вњ… **РќРµС‚ Р±РµСЃРєРѕРЅРµС‡РЅС‹С… СЃРїРёРЅРЅРµСЂРѕРІ** - РІСЃРµ РїСѓС‚Рё Р·Р°РіСЂСѓР·РєРё РёРјРµСЋС‚ С‚Р°Р№РјР°СѓС‚С‹  
вњ… **Р‘С‹СЃС‚СЂС‹Р№ СЃС‚Р°СЂС‚ СЃ РєСЌС€РµРј** - РїРѕРєР°Р·С‹РІР°РµРј РґР°РЅРЅС‹Рµ РјРіРЅРѕРІРµРЅРЅРѕ РїСЂРё РёС… РЅР°Р»РёС‡РёРё  
вњ… **Р—Р°С‰РёС‚Р° РѕС‚ race conditions** - РІСЃРµ РѕР±РЅРѕРІР»РµРЅРёСЏ РїСЂРѕРІРµСЂСЏСЋС‚ `mounted`  
вњ… **Graceful degradation** - fallback РЅР° СЂРѕР»СЊ `'worker'` РїСЂРё РѕС€РёР±РєР°С…

## РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ

### РўРµСЃС‚ 1: РҐРѕР»РѕРґРЅС‹Р№ СЃС‚Р°СЂС‚

1. Р—Р°РєСЂС‹С‚СЊ РїСЂРёР»РѕР¶РµРЅРёРµ РїРѕР»РЅРѕСЃС‚СЊСЋ
2. РћС‚РєСЂС‹С‚СЊ С‡РµСЂРµР· Expo Go
3. вњ… Р”РѕР»Р¶РЅРѕ Р·Р°РіСЂСѓР·РёС‚СЊСЃСЏ Р·Р° 2-5 СЃРµРєСѓРЅРґ
4. вњ… РњР°РєСЃРёРјСѓРј С‡РµСЂРµР· 12 СЃРµРєСѓРЅРґ UI С‚РѕС‡РЅРѕ РїРѕСЏРІРёС‚СЃСЏ

### РўРµСЃС‚ 2: РџР»РѕС…РѕРµ СЃРѕРµРґРёРЅРµРЅРёРµ

1. Р’РєР»СЋС‡РёС‚СЊ СЂРµР¶РёРј "Slow 3G" РІ РЅР°СЃС‚СЂРѕР№РєР°С… СЃРµС‚Рё
2. РџРµСЂРµР·Р°РїСѓСЃС‚РёС‚СЊ РїСЂРёР»РѕР¶РµРЅРёРµ
3. вњ… UI РґРѕР»Р¶РµРЅ РїРѕСЏРІРёС‚СЊСЃСЏ, РїРѕРєР°Р·С‹РІР°СЏ РєСЌС€РёСЂРѕРІР°РЅРЅС‹Рµ РґР°РЅРЅС‹Рµ
4. вњ… РћР±РЅРѕРІР»РµРЅРёРµ РІ С„РѕРЅРµ РїСЂРё РІРѕСЃСЃС‚Р°РЅРѕРІР»РµРЅРёРё СЃРµС‚Рё

### РўРµСЃС‚ 3: РћС„Р»Р°Р№РЅ СЂРµР¶РёРј

1. РћС‚РєР»СЋС‡РёС‚СЊ РёРЅС‚РµСЂРЅРµС‚ РїРѕР»РЅРѕСЃС‚СЊСЋ
2. РџРµСЂРµР·Р°РїСѓСЃС‚РёС‚СЊ РїСЂРёР»РѕР¶РµРЅРёРµ
3. вњ… UI РґРѕР»Р¶РµРЅ РїРѕРєР°Р·Р°С‚СЊ РєСЌС€РёСЂРѕРІР°РЅРЅС‹Рµ РґР°РЅРЅС‹Рµ
4. вњ… Р§РµСЂРµР· 10-12 СЃРµРєСѓРЅРґ UI С‚РѕС‡РЅРѕ РїРѕСЏРІРёС‚СЃСЏ (СЃ РїСѓСЃС‚С‹РјРё РґР°РЅРЅС‹РјРё РµСЃР»Рё РєСЌС€ РїСѓСЃС‚)

### РўРµСЃС‚ 4: Р‘С‹СЃС‚СЂС‹Р№ РїРµСЂРµС…РѕРґ РјРµР¶РґСѓ СЋР·РµСЂР°РјРё

1. Р—Р°Р»РѕРіРёРЅРёС‚СЊСЃСЏ РєР°Рє РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ Рђ
2. Р Р°Р·Р»РѕРіРёРЅРёС‚СЊСЃСЏ
3. Р—Р°Р»РѕРіРёРЅРёС‚СЊСЃСЏ РєР°Рє РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ Р‘
4. вњ… Р”Р°РЅРЅС‹Рµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ Рђ РґРѕР»Р¶РЅС‹ РѕС‡РёСЃС‚РёС‚СЊСЃСЏ
5. вњ… Р”Р°РЅРЅС‹Рµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ Р‘ Р·Р°РіСЂСѓР·СЏС‚СЃСЏ Р·Р° 2-5 СЃРµРєСѓРЅРґ

## Р¤Р°Р№Р»С‹ РёР·РјРµРЅРµРЅС‹

1. вњ… `components/hooks/useQueryWithCache.js` - С‚Р°Р№РјР°СѓС‚С‹ РґР»СЏ Р·Р°РіСЂСѓР·РєРё
2. вњ… `components/hooks/useAuth.js` - С‚Р°Р№РјР°СѓС‚ РґР»СЏ getSession
3. вњ… `components/hooks/useUsers.js` - РїСЂР°РІРёР»СЊРЅС‹Р№ enabled СЃ isAuthenticated
4. вњ… `components/hooks/useDepartments.js` - РїСЂР°РІРёР»СЊРЅС‹Р№ enabled СЃ isAuthenticated
5. вњ… `app/users/index.jsx` - СѓР»СѓС‡С€РµРЅРЅР°СЏ Р»РѕРіРёРєР° isLoading
6. вњ… `app/orders/index.jsx` - С‚Р°Р№РјР°СѓС‚ РґР»СЏ getUserRole

## РњРѕРЅРёС‚РѕСЂРёРЅРі

Р’ РєРѕРЅСЃРѕР»Рё Р±СѓРґСѓС‚ Р»РѕРіРё РїСЂРё СЃСЂР°Р±Р°С‚С‹РІР°РЅРёРё Р·Р°С‰РёС‚РЅС‹С… РјРµС…Р°РЅРёР·РјРѕРІ:

```
вЏ° useQueryWithCache timeout for users:... - force stop loading
вЏ° getUserRole timeout - force stop loading
рџљЁ FORCE READY TIMEOUT - Unblocking UI after 12s
```

Р­С‚Рё Р»РѕРіРё РїРѕРјРѕРіСѓС‚ РІС‹СЏРІРёС‚СЊ СЂРµР°Р»СЊРЅС‹Рµ РїСЂРѕР±Р»РµРјС‹ СЃ СЃРµС‚СЊСЋ РёР»Рё Supabase РґР»СЏ РґР°Р»СЊРЅРµР№С€РµР№ РѕРїС‚РёРјРёР·Р°С†РёРё.
