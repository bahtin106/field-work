# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –°–ø–∏–Ω–Ω–µ—Ä–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Å–ø–∏–Ω–Ω–µ—Ä–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `ready` –≤ `_layout.js` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `true` –∏–∑-–∑–∞ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç "–∑–∞–≤–∏—Å–Ω—É—Ç—å" (–æ—Å–æ–±–µ–Ω–Ω–æ `supabase.auth.getSession()` –∏ `supabase.auth.getUser()`)
2. **–°–æ—Å—Ç–æ—è–Ω–∏–µ `sessionReady` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è**: –ï—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ –≤ `initializeApp`, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è `false`
3. **SIGNED_IN —Ö—ç–Ω–¥–ª–µ—Ä –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è**: –¢—è–∂—ë–ª–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö `finally` –±–ª–æ–∫–æ–≤**: –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –†–µ—à–µ–Ω–∏–µ

### 1. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –≤ `initializeApp` (10 —Å–µ–∫—É–Ω–¥)

```javascript
const initializeApp = async () => {
  // –ö–†–ò–¢–ò–ß–ù–û: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
  maxTimeoutId = setTimeout(() => {
    if (mounted) {
      logger?.warn?.('‚è∞ MAX TIMEOUT REACHED - Force unblock UI');
      setSessionReady(true);
      setAuthChecking(false);
      if (!appReady) setAppReady(true);
    }
  }, 10000); // 10 —Å–µ–∫—É–Ω–¥ - –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –º–∞–∫—Å–∏–º—É–º

  try {
    // ... –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ...
  } finally {
    // –ö–†–ò–¢–ò–ß–ù–û: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É UI –¥–∞–∂–µ –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö
    if (maxTimeoutId) clearTimeout(maxTimeoutId);
    if (mounted) {
      setSessionReady(true);
      setAuthChecking(false);
      if (!appReady) setAppReady(true);
    }
  }
};
```

### 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç (12 —Å–µ–∫—É–Ω–¥)

```javascript
// –ö–†–ò–¢–ò–ß–ù–û: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ - force ready —á–µ—Ä–µ–∑ 12 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
useEffect(() => {
  const forceReadyTimeout = setTimeout(() => {
    if (!appReady || !sessionReady) {
      logger?.warn?.('üö® FORCE READY TIMEOUT - Unblocking UI after 12s');
      setAppReady(true);
      setSessionReady(true);
      setAuthChecking(false);
    }
  }, 12000);

  return () => clearTimeout(forceReadyTimeout);
}, []);
```

### 3. –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ SIGNED_IN —Ö—ç–Ω–¥–ª–µ—Ä–µ (8 —Å–µ–∫—É–Ω–¥)

```javascript
if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
  // –ö–†–ò–¢–ò–ß–ù–û: –°–±—Ä–∞—Å—ã–≤–∞–µ–º authChecking –°–†–ê–ó–£ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
  if (mounted) {
    setAuthChecking(false);
    setSessionReady(true);
    if (!appReady) setAppReady(true);
  }

  // –¢—è–∂—ë–ª–∞—è —Ä–∞–±–æ—Ç–∞ –≤ async —Å —Ç–∞–π–º–∞—É—Ç–æ–º
  const asyncWorkPromise = (async () => {
    // ... –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è, —Ä–æ–ª–∏ –∏ —Ç.–¥. ...
  })();

  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç 8 —Å–µ–∫—É–Ω–¥ –¥–ª—è async —Ä–∞–±–æ—Ç—ã
  const timeoutPromise = new Promise((resolve) => {
    setTimeout(() => {
      logger?.warn?.('‚è∞ SIGNED_IN async work timeout - force finish');
      resolve();
    }, 8000);
  });

  // –ó–∞–ø—É—Å–∫–∞–µ–º race –º–µ–∂–¥—É async —Ä–∞–±–æ—Ç–æ–π –∏ —Ç–∞–π–º–∞—É—Ç–æ–º
  Promise.race([asyncWorkPromise, timeoutPromise]).finally(() => {
    if (mounted) {
      setAuthChecking(false);
      setSessionReady(true);
      if (!appReady) setAppReady(true);
    }
  });
}
```

### 4. Finally –±–ª–æ–∫–∏ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

–ö–∞–∂–¥—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±–ª–æ–∫ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç `finally` —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏–π:

```javascript
try {
  // ... —Ä–∞–±–æ—Ç–∞ ...
} finally {
  if (mounted) {
    setSessionReady(true);
    setAuthChecking(false);
    if (!appReady) setAppReady(true);
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚ùå –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–ø–∏–Ω–Ω–µ—Ä –ø—Ä–∏ —Ö–æ–ª–æ–¥–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ
- ‚ùå –ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- ‚ùå –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è –≤ `initializeApp`
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 12 —Å–µ–∫—É–Ω–¥ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 8 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ —Å–ø–∏–Ω–Ω–µ—Ä –≤—Å—ë –µ—â—ë –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```javascript
logger?.warn?.('‚è∞ MAX TIMEOUT REACHED - Force unblock UI');
logger?.warn?.('üö® FORCE READY TIMEOUT - Unblocking UI after 12s');
logger?.warn?.('‚è∞ SIGNED_IN async work timeout - force finish');
```

–≠—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞–∂—É—Ç, –∫–∞–∫–æ–π —Ç–∞–π–º–∞—É—Ç —Å—Ä–∞–±–æ—Ç–∞–ª –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª UI.

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã** - 10-12 —Å–µ–∫—É–Ω–¥ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
2. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `finally` –±–ª–æ–∫–∏** - –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `mounted`** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `logger.warn`** - –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ production

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. –•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∑–∞ 3-5 —Å–µ–∫—É–Ω–¥
2. –õ–æ–≥–∏–Ω - –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∑–∞ 2-3 —Å–µ–∫—É–Ω–¥—ã
3. –í—ã—Ö–æ–¥ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ - –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π
4. –ü–ª–æ—Ö–∞—è —Å–µ—Ç—å - –º–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è
5. –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –∫—ç—à–∞

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 17 –Ω–æ—è–±—Ä—è 2025  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**: `app/_layout.js`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –í–´–°–û–ö–ê–Ø ‚ö†Ô∏è
