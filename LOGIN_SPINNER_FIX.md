# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–ø–∏–Ω–µ—Ä–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ª–æ–≥–∏–Ω–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–ø–∏–Ω–µ—Ä. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å, –Ω–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞.

## –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. Race Condition –≤ `_layout.js`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ `SIGNED_IN` event —Ñ–ª–∞–≥ `authChecking` –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –±–ª–æ–∫–∏—Ä—É—è –Ω–∞–≤–∏–≥–∞—Ü–∏—é.

**–°–ª–µ–¥—Å—Ç–≤–∏—è:**

- –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ `/orders` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ (—É—Å–ª–æ–≤–∏–µ `if (!ready || authChecking)` –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ)
- –°–ø–∏–Ω–µ—Ä –Ω–∞ –∫–Ω–æ–ø–∫–µ –≤—Ö–æ–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–ª –∫—Ä—É—Ç–∏—Ç—å—Å—è
- UI –æ—Å—Ç–∞–≤–∞–ª—Å—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–º

### 2. –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `appReadyState`

**–ü—Ä–æ–±–ª–µ–º–∞:** `appReadyState` –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–º –ª–æ–≥–∏–Ω–µ.

**–°–ª–µ–¥—Å—Ç–≤–∏—è:**

- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `'ready'` –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–µ—Å—Å–∏–∏
- Bottom bar –Ω–µ —Å–∫—Ä—ã–≤–∞–ª—Å—è –ø—Ä–∏ –ª–æ–≥–∞—É—Ç–µ
- –ü—Ä–∏ –Ω–æ–≤–æ–º –ª–æ–≥–∏–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### 3. –¢–∞–π–º–∞—É—Ç –≤ `useAuthLogin` –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç 1000–º—Å –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ auth event.

**–°–ª–µ–¥—Å—Ç–≤–∏—è:**

- –°–ø–∏–Ω–µ—Ä —Å–Ω–∏–º–∞–ª—Å—è –¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ò–ª–∏ –Ω–µ —Å–Ω–∏–º–∞–ª—Å—è –≤–æ–æ–±—â–µ –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–ª–∞ > 1—Å
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —è–≤–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ SIGNED_IN

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–∞–≥–∞–ª–∏—Å—å –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç –≤ `RootLayoutInner`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å.

**–°–ª–µ–¥—Å—Ç–≤–∏—è:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∞–ª—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ª–æ–≥–∏–Ω–∞
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∞–ª–∞

## –†–µ—à–µ–Ω–∏–µ

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å `authChecking` –≤ `_layout.js`

```javascript
if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
  logger?.warn?.(`üîê Auth event: ${event}`);

  // –ö–†–ò–¢–ò–ß–ù–û: –°–±—Ä–∞—Å—ã–≤–∞–µ–º authChecking –°–†–ê–ó–£ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
  if (mounted) {
    setAuthChecking(false);
  }

  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- UI –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π
- –£—Å–ª–æ–≤–∏–µ `if (!ready || authChecking)` –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –∫–æ–¥

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å `appReadyState`

```javascript
// –í _layout.js –ø–æ—Å–ª–µ SIGNED_IN
try {
  const { default: appReadyState } = await import('../lib/appReadyState');
  appReadyState.reset();
  logger?.warn?.('üîÑ appReadyState reset for new login');
} catch (e) {
  logger?.warn?.('Failed to reset appReadyState:', e?.message || e);
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—á–Ω—ë—Ç —Å —á–∏—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è `'boot'`
- Bottom bar —Å–∫—Ä–æ–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∂–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–±—Ä–æ—Å–µ

### 3. –Ø–≤–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ SIGNED_IN

```javascript
// –í _layout.js –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π SIGNED_IN
if (mounted) {
  try {
    _router.replace('/orders');
    logger?.warn?.('‚úÖ Navigation to /orders executed');
  } catch (e) {
    logger?.warn?.('Navigation failed:', e?.message || e);
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ**
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π
- –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —É—Å–ø–µ—Ö/–ø—Ä–æ–≤–∞–ª

### 4. –£–º–Ω—ã–π —Å–Ω—è—Ç–∏–µ loading –≤ `useAuthLogin.js`

```javascript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ auth state change
const authSubscription = supabase.auth.onAuthStateChange((event) => {
  if (event === 'SIGNED_IN' && isMountedRef.current) {
    setTimeout(() => {
      if (isMountedRef.current) {
        setLoading(false);
        logger.debug('Loading cleared after SIGNED_IN event');
      }
    }, 500);
    authSubscription?.data?.subscription?.unsubscribe?.();
  }
});

// –°—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π —Ç–∞–π–º–∞—É—Ç
setTimeout(() => {
  if (isMountedRef.current) {
    setLoading(false);
    logger.debug('Loading cleared by fallback timeout');
  }
  authSubscription?.data?.subscription?.unsubscribe?.();
}, 2000);
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- Loading —Å–Ω–∏–º–µ—Ç—Å—è –ª–∏–±–æ –ø—Ä–∏ `SIGNED_IN` event (500–º—Å –ø–æ—Å–ª–µ)
- –õ–∏–±–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã (—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞)
- –ü–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- –£—á–∏—Ç—ã–≤–∞–µ—Ç unmount –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `appReadyState.js`

```javascript
setBootState(state) {
  if (this.bootState.current !== state) {
    if (typeof __DEV__ !== 'undefined' && __DEV__) {
      console.warn(`[AppReadyState] ${this.bootState.current} ‚Üí ${state}`);
    }
    this.bootState.current = state;
    this.notifyListeners();
  }
}

reset() {
  if (typeof __DEV__ !== 'undefined' && __DEV__) {
    console.warn('[AppReadyState] üîÑ Reset triggered');
  }
  this.bootState.current = 'boot';
  this.bootState.mountTs = Date.now();
  this.notifyListeners();
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- –í–∏–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ dev —Ä–µ–∂–∏–º–µ
- –õ–µ–≥–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞ —Å–±—Ä–æ—Å–∞

### 6. –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–∏ mount –≤ `app/orders/index.jsx`

```javascript
// –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
React.useEffect(() => {
  const currentState = appReadyState.getBootState();
  if (currentState !== bootState) {
    if (typeof __DEV__ !== 'undefined' && __DEV__) {
      console.warn(
        `[IndexScreen] State mismatch on mount: local=${bootState}, global=${currentState}`,
      );
    }
    setBootState(currentState);
  }
}, []);
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ mount
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π

### 7. –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ Bottom Bar –ø—Ä–∏ —Å–±—Ä–æ—Å–µ

```javascript
// –í BottomNav.jsx
React.useEffect(() => {
  if (!appReady && navVisible) {
    setNavVisible(false);
    appear.setValue(0);
  }
}, [appReady, navVisible, appear]);
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**

- Bar —Å–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∞—É—Ç–µ/—Å–±—Ä–æ—Å–µ
- –ù–µ –±—É–¥–µ—Ç –≤–∏—Å–µ—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ª–æ–≥–∏–Ω–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π

## –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω

1. **–ù–∞–∂–∞—Ç–∏–µ "–í–æ–π—Ç–∏"**
   - `useAuthLogin`: `setLoading(true)`
   - `supabase.auth.signInWithPassword()`

2. **Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Å—Å–∏—é**
   - `useAuthLogin`: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `onAuthStateChange`
   - –ñ–¥—ë—Ç `SIGNED_IN` event

3. **`_layout.js` –ø–æ–ª—É—á–∞–µ—Ç `SIGNED_IN`**
   - **–°–†–ê–ó–£**: `setAuthChecking(false)` ‚úÖ
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è, —Ä–æ–ª–∏
   - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à
   - `setIsLoggedIn(true)`, `setSessionReady(true)`
   - –ü–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`setAppKey(prev => prev + 1)`)
   - **–°–±—Ä–æ—Å**: `appReadyState.reset()` ‚úÖ
   - **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: `_router.replace('/orders')` ‚úÖ
   - `bumpSessionEpoch()`

4. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `'boot'`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç loader
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–æ–ª—å (–∏–∑ –∫—ç—à–∞ ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
   - –ü–µ—Ä–µ—Ö–æ–¥ `'boot'` ‚Üí `'fetching'` ‚Üí `'ready'`
   - `appReadyState.setBootState('ready')`

5. **Bottom Bar –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**
   - `appReady` ‚Üí `true`
   - `dataReady` (—Ä–æ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞) ‚Üí `true`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –≥–ª–∞–≤–Ω–æ–π

6. **`useAuthLogin` —Å–Ω–∏–º–∞–µ—Ç loading**
   - –ü–æ–ª—É—á–∞–µ—Ç `SIGNED_IN` event —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É
   - –ß–µ—Ä–µ–∑ 500–º—Å: `setLoading(false)` ‚úÖ
   - (–∏–ª–∏ —Å—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π —Ç–∞–π–º–∞—É—Ç 2—Å)

7. **–†–µ–∑—É–ª—å—Ç–∞—Ç**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏
   - Bottom bar –ø–æ—è–≤–∏–ª—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –°–ø–∏–Ω–µ—Ä –Ω–∞ –∫–Ω–æ–ø–∫–µ –∏—Å—á–µ–∑
   - –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

## –ó–∞—â–∏—Ç–∞ –æ—Ç edge cases

### Edge Case 1: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å

**–ó–∞—â–∏—Ç–∞:**

- –°—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π —Ç–∞–π–º–∞—É—Ç 2000–º—Å –≤ `useAuthLogin`
- `MAX_BOOT_MS = 5000` –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

### Edge Case 2: Unmount –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ª–æ–≥–∏–Ω–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ó–∞—â–∏—Ç–∞:**

- `isMountedRef.current` –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ –≤—Å–µ—Ö –∫–æ–ª–ª–±—ç–∫–∞—Ö
- –û—Ç–ø–∏—Å–∫–∞ –æ—Ç auth subscription –≤ cleanup
- `abortControllerRef` –æ—Ç–º–µ–Ω—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### Edge Case 3: –î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"

**–ó–∞—â–∏—Ç–∞:**

- `if (loading) return;` –≤ `handleLogin`
- `canSubmit` —É—á–∏—Ç—ã–≤–∞–µ—Ç `loading` —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `disabled={!canSubmit}` –Ω–∞ –∫–Ω–æ–ø–∫–µ

### Edge Case 4: –û—à–∏–±–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–ó–∞—â–∏—Ç–∞:**

- try/catch –≤–æ–∫—Ä—É–≥ `_router.replace()`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
- Fallback —Ç–∞–π–º–∞—É—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–Ω–∏–º–µ—Ç loading

### Edge Case 5: appReadyState –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è

**–ó–∞—â–∏—Ç–∞:**

- try/catch –≤–æ–∫—Ä—É–≥ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ `import('../lib/appReadyState')`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
- –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É

### Edge Case 6: –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ó–∞—â–∏—Ç–∞:**

- –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ mount –≤ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ mismatch

### Edge Case 7: Bottom bar –Ω–µ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∞—É—Ç–µ

**–ó–∞—â–∏—Ç–∞:**

- –≠—Ñ—Ñ–µ–∫—Ç —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ `!appReady && navVisible`
- –°–±—Ä–æ—Å `appear` –∞–Ω–∏–º–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ pathname –¥–ª—è `/(auth)` –º–∞—Ä—à—Ä—É—Ç–æ–≤

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏ –≤ dev —Ä–µ–∂–∏–º–µ

**–£—Å–ø–µ—à–Ω—ã–π –ª–æ–≥–∏–Ω:**

```
üîê Auth event: SIGNED_IN
üë§ Current user: <uid>
‚úÖ Profile loaded: role=admin
üé≠ User role resolved: admin
üì¶ Cached userRole: admin
üì¶ Cached profile for user: <uid>
‚úÖ State updated: isLoggedIn=true, role=admin
üîÑ App remounted with new key
‚è∞ Session epoch bumped
üîÑ appReadyState reset for new login
[AppReadyState] üîÑ Reset triggered
‚úÖ Navigation to /orders executed
[AppReadyState] boot ‚Üí fetching
[AppReadyState] fetching ‚Üí ready
Loading cleared after SIGNED_IN event
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ï—Å—Ç—å –ª–∏ `setAuthChecking(false)` –≤ –ª–æ–≥–µ?
2. –ï—Å—Ç—å –ª–∏ `‚úÖ Navigation to /orders executed`?
3. –ï—Å—Ç—å –ª–∏ `appReadyState reset`?
4. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `ready`?

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—ã—Ö–æ–¥ ‚Üí –í—Ö–æ–¥ ‚Äî —Å–ø–∏–Ω–µ—Ä –∏—Å—á–µ–∑–∞–µ—Ç, –≥–ª–∞–≤–Ω–∞—è –≥—Ä—É–∑–∏—Ç—Å—è
- [ ] –ë—ã—Å—Ç—Ä–∞—è —Å–µ—Ç—å ‚Äî –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- [ ] –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å ‚Äî —Ç–∞–π–º–∞—É—Ç—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç
- [ ] –î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ "–í–æ–π—Ç–∏" ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- [ ] Unmount —ç–∫—Ä–∞–Ω–∞ –ª–æ–≥–∏–Ω–∞ ‚Äî –Ω–µ—Ç —É—Ç–µ—á–µ–∫
- [ ] –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ—à–∏–±–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, loading —Å–Ω–∏–º–∞–µ—Ç—Å—è
- [ ] –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
- [ ] Bottom bar –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- [ ] –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
2. –í—ã–π—Ç–∏ (–∫–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è")
3. –î–æ–∂–¥–∞—Ç—å—Å—è —ç–∫—Ä–∞–Ω–∞ –ª–æ–≥–∏–Ω–∞
4. –í–≤–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. –ù–∞–∂–∞—Ç—å "–í–æ–π—Ç–∏"
6. **–û–∂–∏–¥–∞–Ω–∏–µ:** —Å–ø–∏–Ω–µ—Ä ~0.5-2—Å, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é, bottom bar –≤–∏–¥–µ–Ω

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ—à–µ–Ω–∏–µ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚úÖ **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI** ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å `authChecking`
2. ‚úÖ **–ß–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Äî —Å–±—Ä–æ—Å `appReadyState` –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
3. ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** ‚Äî —è–≤–Ω—ã–π `_router.replace()`
4. ‚úÖ **–£–º–Ω–æ–µ —Å–Ω—è—Ç–∏–µ loading** ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ auth events + —Å—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π —Ç–∞–π–º–∞—É—Ç
5. ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ + –ø–æ–¥–ø–∏—Å–∫–∏
6. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –≤–∏–¥–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –≤ dev —Ä–µ–∂–∏–º–µ
7. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç edge cases** ‚Äî —Ç–∞–π–º–∞—É—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏ mounted, try/catch

**–†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç –ö–∞–ª–∞—à–Ω–∏–∫–æ–≤–∞:** –Ω–∞–¥—ë–∂–Ω–æ, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö. üî´‚úÖ
